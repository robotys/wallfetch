<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
	<script>
		var stop_feeding = false;
		var total_feed = 0;
		var last_next = '';
		var last_response;
		// load fb sdk
		window.fbAsyncInit = function() {
			FB.init({
				appId      : '344154972452584',
				xfbml      : false,
				version    : 'v2.1',
				status	   : true
			});

			// run code here
			$(document).ready(function(){
				
				FB.login(function(){
					
					get_feed();
				
				}, {scope: 'read_stream'});

			});
		};

		(function(d, s, id){
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) {return;}
			js = d.createElement(s); js.id = id;
			js.src = "//connect.facebook.net/en_US/sdk.js";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));


		function get_feed(next){
			// console.log(stop_feeding);
			if(stop_feeding == false){
				if(next == undefined) next = '/me/feed?limit=1000&fields=message';
				FB.api(
				    next,
				    function (response) {
				      if (response && !response.error) {
				        /* handle the result */
				        if(response.paging != undefined){
				        	// console.log('fetch '+response.data.length,'paging: ',response.paging.next);	
				        	// console.log(response);
					        total_feed = total_feed+response.data.length;
					        var status = 'total fetched: '+total_feed+'. Next batch ...';
					        // console.log('bytes: '+ $('.feeds').html().length);
					        $('.status').html(status);

					        var title = '('+total_feed+') WALLFETCH';
					        $('title').html(title);
					        show_feed(response);
					        get_feed(response.paging.next);
					        last_next = next;
					        last_response = response;
				        } 
				        else{
							// kalau rosak, run manually!
				        	console.log('Last: '+last_next, last_response);
				        	console.log('Now: '+next, response);
				        	// console.log('bytes: '+ $('.feeds').html().length);

				        	$.get(last_next, function(resp){
				        		console.log(resp);
				        		// show_feed(resp);
					        	// get_feed(resp.paging.next);
				        	});
				        	// get_feed(last_next);

				        	// $('.status').html('Done! Total fetched: '+total_feed);
				        	// $('.feed_switch').hide();
				        } 

				      }
				    }
				);
			}
		}

		function show_feed(response){
			$.each(response.data, function(index,object){
				if(object.message !== undefined){
					var feed = ''+(object.message)+'\n\n___________________________________\n\n\n';
					$('.feeds').append(feed);
				}
			});
		}

		$(document).ready(function(){
			$('#feed_switch').on('click', function(){
				stop_feeding = true;
			});
		});
		
    </script>

    <style>
    	body{
    		font-family: sans-serif;
    		font-size: 16px;
    		color: #444;
    		text-align: center;
    	}

    	.center{
    		width: 500px;
    		margin: 0 auto;
    	}

    	.wrap{
    		width: 500px;
    		float: left;
    	}

    	.status{
    		background: #ccc;
    		padding: 8px;
    		width: 100%;
    	}
    </style>

</head>
<body>

<div class="center"><div class="wrap">
	

	<h1>Get My FB Wall Status</h1>
	<p>As the name indicates, give us your fb permission and we will get all of your wall fb status. Then you can just select all and save it into a text file or word for further processing</p>

	<p><span class="status"></span> <br/> <button id="feed_switch">stop feed</button>
	</p>

	<textarea class="feeds" style="width: 480px; height: 500px;">
		
	</textarea>
</div></div>

</body>
</html>